<!DOCTYPE html>
<head>
  <title>Issue updates</title>
  <style>
  body {
    font-family: sans-serif;
  }
  ul {
    padding-left: 1em;
  }
  ul.issue {
    padding-left: 0em;
    list-style-type: none;
    margin-bottom: 1em;
  }
  ul.issue > li {
    margin: .5em 0;
  }
  ul.issue p {
    margin: 0 0 0 2em;
  }
  ul.comment {
    padding-left: 3em;
  }
  .icon {
    display: inline-block;
    width: .75em;
    color: #ccc;
  }
  .icon.created, .icon.closed {
    color: black;
  }
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underscore;
  }
  .label {
    padding: .2em 0.5em;
    border-radius: 2em;
    font-size: 75%;
  }
  </style>
<body>
<h1>Issue updates since {{ since|datetime("%Y-%m-%d") }}</h1>
<ul class="repo">
  {% for thing, issues in results -%}
    <li>
      <b><a href="{{ thing.url }}">
      {% if thing.kind == "repo" %}
        {{ thing.nameWithOwner }}
      {% elif thing.kind == "project" %}
        {{ thing.title }}
      {% endif %}
      </a></b>
      {{ thing.kind }}
      <ul class="issue">
        {% for issue in issues -%}
          <li class="{{ issue.state|lower }}">
            {% if issue.reasonCreated %}<span class="icon created">&Star;{% else %}<span class="icon">&ndash;{% endif %}</span>
            {% if issue.reasonClosed %}<span class="icon closed">&times;{% else %}<span class="icon">&ndash;{% endif %}</span>
            <a href="{{ issue.url }}">{{ issue.number }}: <b>{{issue.title}}</b></a>
            [{{ issue.author.login }}]
            {% if kind == "project" %}{{ issue.repository.nameWithOwner }}{% endif %}
            {% for label in issue.labels.nodes %}
              <span class="label" style="background: #{{label.color}}; color: {{label.color|textcolor}}">{{ label.name }}</span>
            {% endfor %}
            <p>{{ issue.body|truncate(120) }}</p>
            <ul class="comment">
              {% for comment in issue.comments.nodes -%}
                <li>
                  {# <img src="{{comment.author.avatarUrl}}&size=20"/> #}
                  <a href="{{ comment.url }}">{{ comment.updatedAt|datetime() }}</a>
                  [{{ comment.author.login }}]
                  {{ comment.body|trim|truncate(120) }}
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </li>
  {% endfor %}
</ul>
